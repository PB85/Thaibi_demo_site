<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h3>ABKezel≈ë</h3>
    <p>
        using System.Data.SqlClient;
        using System.Configuration;
        using System.Drawing;
    </p>
    <p>
        public static void Csatlakozas()
        {
        try
        {
        kapcsolat = new SqlConnection();
        kapcsolat.ConnectionString = ConfigurationManager.ConnectionStrings["ConStr"].ConnectionString;
        kapcsolat.Open();

        parancs = new SqlCommand();
        parancs.Connection = kapcsolat;
        }
        catch (Exception ex)
        {
        throw new ABKivetel("Sikertelen csatlakozas!", ex);
        }
        }
    </p>
    <p>
        public static void Lecsatlakozas()
        {
        try
        {
        kapcsolat.Close();
        parancs.Dispose();
        }
        catch (Exception ex)
        {
        throw new ABKivetel("Sikertelen lecsatlakozas!", ex);
        }
        }
    </p>

    <p>
        public static List<Televizio> TeleviziokListazasa()
            {
            try
            {
            parancs.Parameters.Clear();
            parancs.CommandText = "SELECT * FROM [ElektronikaiCikk] INNER JOIN [Televizio] ON [ElektronikaiCikk].[Id] =
            [Televizio].[Id]";
            List<Televizio> televiziok = new List<Televizio>();

                    using (SqlDataReader olvaso = parancs.ExecuteReader())
                    {
                    while (olvaso.Read())
                    {
                    televiziok.Add(new Televizio((KijelzoTechnologia)(int)olvaso["KijelzoTechnologia"],
                    (int)olvaso["Kepatlo"], (int)olvaso["Id"], olvaso["Gyarto"].ToString(), olvaso["Tipus"].ToString(),
                    (int)olvaso["Fogyasztas"], (int)olvaso["Ar"], (int)olvaso["KiadasEve"]));
                    }

                    olvaso.Close();
                    }

                    return televiziok;
                    }
                    catch (Exception ex)
                    {
                    throw new ABKivetel("Sikertelen televizio kilistazas!", ex);
                    }
                    }
    </p>

    <p>
        public static void TelevizioFelvitele(Televizio televizio)
        {
        try
        {
        parancs.Parameters.Clear();
        parancs.CommandText = "INSERT INTO [ElektronikaiCikk]([Gyarto], [Tipus], [Fogyasztas], [Ar], [KiadasEve]) OUTPUT
        INSERTED.Id VALUES (@gyarto, @tipus, @fogyasztas, @ar, @kiadasEve)";
        parancs.Parameters.AddWithValue("@gyarto", televizio.Gyarto);
        parancs.Parameters.AddWithValue("@tipus", televizio.Tipus);
        parancs.Parameters.AddWithValue("@fogyasztas", televizio.Fogyasztas);
        parancs.Parameters.AddWithValue("@ar", televizio.Ar);
        parancs.Parameters.AddWithValue("@kiadasEve", televizio.KiadasEve);

        televizio.Id = (int)parancs.ExecuteScalar();

        parancs.Parameters.Clear();
        parancs.CommandText = "INSERT INTO [Televizio] VALUES (@id, @kijelzoTechnologia, @kepatlo)";
        parancs.Parameters.AddWithValue("@id", televizio.Id);
        parancs.Parameters.AddWithValue("@kijelzoTechnologia", televizio.KijelzoTechnologia);
        parancs.Parameters.AddWithValue("@kepatlo", televizio.Kepatlo);

        parancs.ExecuteNonQuery();
        }
        catch (Exception ex)
        {
        throw new ABKivetel("Sikertelen televizio felvitel!", ex);
        }
        }
    </p>

    <p>
        public static void TelevizioModositasa(Televizio televizio)
        {
        try
        {
        parancs.Parameters.Clear();
        parancs.CommandText = "UPDATE [ElektronikaiCikk] SET [Ar] = @ar WHERE [Id] = @id";
        parancs.Parameters.AddWithValue("@ar", televizio.Ar);
        parancs.Parameters.AddWithValue("@id", televizio.Id);
        parancs.ExecuteNonQuery();
        }
        catch (Exception ex)
        {
        throw new ABKivetel("Sikertelen televizio modositas!", ex);
        }
        }
    </p>

    <p>
        public static void TelevizioTorlese(Televizio televizio)
        {
            try
            {
                //Eloszor onnan torlok ahol az FK van
                parancs.Parameters.Clear();
                parancs.CommandText = "DELETE FROM [Televizio] WHERE [Id] = @id";
                parancs.Parameters.AddWithValue("@id", televizio.Id);
                parancs.ExecuteNonQuery();

                //Utana onnan torlok ahova az FK mutatott
                parancs.Parameters.Clear();
                parancs.CommandText = "DELETE FROM [ElektronikaiCikk] WHERE [Id] = @id";
                parancs.Parameters.AddWithValue("@id", televizio.Id);
                parancs.ExecuteNonQuery();
            }
            catch (Exception ex)
            {
                throw new ABKivetel("Sikertelen televizio torles!", ex);
            }
        }
    </p>

<p>
    public static void TelevizioTorlese(int id)
        {
            try
            {
                //Eloszor onnan torlok ahol az FK van
                parancs.Parameters.Clear();
                parancs.CommandText = "DELETE FROM [Televizio] WHERE [Id] = @id";
                parancs.Parameters.AddWithValue("@id", id);
                parancs.ExecuteNonQuery();

                //Utana onnan torlok ahova az FK mutatott
                parancs.Parameters.Clear();
                parancs.CommandText = "DELETE FROM [ElektronikaiCikk] WHERE [Id] = @id";
                parancs.Parameters.AddWithValue("@id", id);
                parancs.ExecuteNonQuery();
            }
            catch (Exception ex)
            {
                throw new ABKivetel("Sikertelen televizio torles!", ex);
            }
        }
</p>

<h3>form</h3> 
<p>
    public partial class frm_ElektronikaiCikkek : Form
    {
        #region Adattagok
        private List<Televizio> televiziok;
        private List<Projektor> projektorok;
        #endregion

        #region Konstruktor
        public frm_ElektronikaiCikkek()
        {
            InitializeComponent();
            ABKezelo.Csatlakozas();

            try
            {
                TeleviziokFrissitese();
                ProjektorokFrissitese();
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
</p>
<p>
    public void TeleviziokFrissitese()
    {
        televiziok = null;
        televiziok = ABKezelo.TeleviziokListazasa();

        lb_Televiziok.DataSource = null;
        lb_Televiziok.DataSource = televiziok;
    }
</p>
<p>
    private void frm_ElektronikaiCikkek_FormClosing(object sender, FormClosingEventArgs e)
        {
            ABKezelo.Lecsatlakozas();
        }
</p>
<p>
    private void bt_UjTv_Click(object sender, EventArgs e)
        {
            frm_TelevizioUrlap frm = new frm_TelevizioUrlap();
            if (frm.ShowDialog() == DialogResult.OK)
            {
                try
                {
                    ABKezelo.TelevizioFelvitele(frm.Televizio);
                    TeleviziokFrissitese();
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }
</p>
<p>
    private void bt_Torol_Click(object sender, EventArgs e)
        {
            if (lb_Televiziok.SelectedIndex != -1)
            {
                if (MessageBox.Show("Biztos torli a televiziot?", "Torles", MessageBoxButtons.OKCancel, MessageBoxIcon.Question) == DialogResult.OK)
                {
                    try
                    {
                        Televizio televizio = (Televizio)lb_Televiziok.SelectedItem;
                        ABKezelo.TelevizioTorlese(televizio);
                        TeleviziokFrissitese();
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }
            }
            else
            {
                MessageBox.Show("Jeloljon ki egy televiziot!", "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
</p>
<p>
    private void bt_TvModosit_Click(object sender, EventArgs e)
        {
            if (lb_Televiziok.SelectedIndex != -1)
            {
                Televizio televizio = (Televizio)lb_Televiziok.SelectedItem;
                frm_TelevizioUrlap frm = new frm_TelevizioUrlap(televizio);
                if (frm.ShowDialog() == DialogResult.OK)
                {
                    try
                    {
                        ABKezelo.TelevizioModositasa(frm.Televizio);
                        TeleviziokFrissitese();
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    }
                }
            }
            else
            {
                MessageBox.Show("Jeloljon ki egy televiziot!", "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
</p>
<h3>urlap</h3>
<p>
    public frm_TelevizioUrlap()
    {
        InitializeComponent();
        cb_Kijelzo.DataSource = Enum.GetValues(typeof(KijelzoTechnologia));
        nud_KiadasEve.Maximum = DateTime.Now.Year;
    }
</p>
<p>
    public frm_TelevizioUrlap(Televizio televizio) : this()
    {
        this.televizio = televizio;

        tb_Gyarto.Text = televizio.Gyarto;
        tb_Tipus.Text = televizio.Tipus;
        nud_Fogyasztas.Value = televizio.Fogyasztas;
        nud_Ar.Value = televizio.Ar;
        nud_KiadasEve.Value = televizio.KiadasEve;
        cb_Kijelzo.SelectedItem = televizio.KijelzoTechnologia;
        nud_Kepatlo.Value = televizio.Kepatlo;

        tb_Gyarto.Enabled = false;
        tb_Tipus.Enabled = false;
        nud_Fogyasztas.Enabled = false;
        nud_KiadasEve.Enabled = false;
        cb_Kijelzo.Enabled = false;
        nud_Kepatlo.Enabled = false;
    }
</p>
<p>
    private void bt_Ok_Click(object sender, EventArgs e)
    {
        try
        {
            if (televizio == null)
            {
                televizio = new Televizio((KijelzoTechnologia)cb_Kijelzo.SelectedItem, (int)nud_Kepatlo.Value, tb_Gyarto.Text, tb_Tipus.Text, (int)nud_Fogyasztas.Value, (int)nud_Ar.Value, (int)nud_KiadasEve.Value);
            }
            else
            {
                televizio.Ar = (int)nud_Ar.Value;
            }
        }
        catch (Exception ex)
        {
            MessageBox.Show(ex.Message, "Hiba", MessageBoxButtons.OK, MessageBoxIcon.Error);
            DialogResult = DialogResult.None;
        }
    }
</p>
<p>
    public Televizio Televizio { get => televizio; }
</p>
<p>
    CREATE TABLE [ElektronikaiCikk] (
	[Id] INT NOT NULL PRIMARY KEY IDENTITY(1, 1),
	[Gyarto] VARCHAR(128) NOT NULL,
	[Tipus] VARCHAR(128) NOT NULL,
	[Fogyasztas] INT NOT NULL,
	[Ar] INT NOT NULL,
	[KiadasEve] INT NOT NULL
);

CREATE TABLE [Televizio] (
	[Id] INT NOT NULL PRIMARY KEY,
	[KijelzoTechnologia] INT NOT NULL,
	[Kepatlo] INT NOT NULL,

	CONSTRAINT [FK_TId_ECId] FOREIGN KEY ([Id]) REFERENCES [ElektronikaiCikk]([Id])
);
    </p>
<p>
	<connectionStrings>
        <add name="ConStr" connectionString="Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\12011c1gyak.mdf;Integrated Security=True" />
    </connectionStrings>
</p>
</body>

</html>
